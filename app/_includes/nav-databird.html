<nav class="navbar-databird" role="navigation" aria-label="Navigation principale">
  <div class="navbar-databird-content">
    <!-- Brand/Logo -->
    {%- if site.title-img -%}
      <a class="navbar-databird-brand" href="{{ '/' | relative_url }}" aria-label="Accueil">
        <img src="{{ site.title-img | relative_url }}" alt="{{ site.title }} Logo">
        <span>{{ site.title }}</span>
      </a>
    {%- elsif site.title -%}
      <a class="navbar-databird-brand" href="{{ '/' | relative_url }}" aria-label="Accueil">
        {{ site.title }}
      </a>
    {%- endif -%}

    <!-- Navigation (une seule liste : barre sur desktop, tiroir sur mobile) -->
    <div class="navbar-databird-drawer" id="mobile-menu" aria-hidden="true" aria-label="Menu de navigation">
      <ul class="navbar-databird-nav">
      <li class="navbar-databird-nav-item">
        <a href="{{ '/' | relative_url }}" class="navbar-databird-nav-link {% if page.url == '/' %}active{% endif %}" data-i18n="nav.home">
          Accueil
        </a>
      </li>

      <!-- Categories Dropdown -->
      <li class="navbar-databird-nav-item navbar-databird-dropdown">
        <a href="#" class="navbar-databird-nav-link" aria-haspopup="true" aria-expanded="false" id="categories-dropdown-trigger" data-i18n="nav.categories">
          Catégories
          <i class="fas fa-chevron-down" style="font-size: 0.75rem;"></i>
        </a>
        <ul class="navbar-databird-dropdown-menu" role="menu" id="categories-dropdown">
          <li role="none">
            <a href="{{ '/tags/data-analytics' | relative_url }}" class="navbar-databird-dropdown-item" role="menuitem">
              <i class="fas fa-chart-bar" style="margin-right: 0.5rem; color: var(--db-primary);"></i>
              Data Analytics
            </a>
          </li>
          <li role="none">
            <a href="{{ '/tags/data-science' | relative_url }}" class="navbar-databird-dropdown-item" role="menuitem">
              <i class="fas fa-flask" style="margin-right: 0.5rem; color: var(--db-primary);"></i>
              Data Science
            </a>
          </li>
          <li role="none">
            <a href="{{ '/tags/intelligence-artificielle' | relative_url }}" class="navbar-databird-dropdown-item" role="menuitem">
              <i class="fas fa-robot" style="margin-right: 0.5rem; color: var(--db-primary);"></i>
              Intelligence Artificielle
            </a>
          </li>
          <li role="none">
            <a href="{{ '/tags/data-engineering' | relative_url }}" class="navbar-databird-dropdown-item" role="menuitem">
              <i class="fas fa-cogs" style="margin-right: 0.5rem; color: var(--db-primary);"></i>
              Data Engineering
            </a>
          </li>
          <li role="none">
            <a href="{{ '/tags/business-intelligence' | relative_url }}" class="navbar-databird-dropdown-item" role="menuitem">
              <i class="fas fa-briefcase" style="margin-right: 0.5rem; color: var(--db-primary);"></i>
              Business Intelligence
            </a>
          </li>
          <li role="separator" style="height: 1px; background: var(--db-border); margin: 0.5rem 0;"></li>
          <li role="none">
            <a href="{{ '/tags/' | relative_url }}" class="navbar-databird-dropdown-item" role="menuitem" style="font-weight: 600; color: var(--db-primary);" data-i18n="nav.allCategories">
              <i class="fas fa-tags" style="margin-right: 0.5rem;"></i>
              Toutes les catégories
            </a>
          </li>
        </ul>
      </li>

      {%- for link in site.navbar-links -%}
        {%- if link[1].first %}
          <li class="navbar-databird-nav-item navbar-databird-dropdown">
            <a href="#" class="navbar-databird-nav-link" aria-haspopup="true" aria-expanded="false">
              {{ link[0] }}
              <i class="fas fa-chevron-down" style="font-size: 0.75rem;"></i>
            </a>
            <ul class="navbar-databird-dropdown-menu" role="menu">
              {%- for childlink in link[1] -%}
                {%- for linkparts in childlink %}
                  <li role="none">
                    <a href="{{ linkparts[1] | relative_url }}" class="navbar-databird-dropdown-item" role="menuitem">
                      {{ linkparts[0] }}
                    </a>
                  </li>
                {%- endfor -%}
              {%- endfor %}
            </ul>
          </li>
        {% else %}
          <li class="navbar-databird-nav-item">
            <a href="{{ link[1] | relative_url }}" class="navbar-databird-nav-link {% if page.url == link[1] %}active{% endif %}">
              {{ link[0] }}
            </a>
          </li>
        {%- endif -%}
      {%- endfor -%}

      <li class="navbar-databird-nav-item">
        <a href="{{ '/tags/' | relative_url }}" class="navbar-databird-nav-link {% if page.url contains '/tags' %}active{% endif %}" data-i18n="nav.tags">
          Tags
        </a>
      </li>
      <li class="navbar-databird-nav-item">
        <a href="#contact" class="navbar-databird-nav-link" data-i18n="nav.contact">
          Contact
        </a>
      </li>
      <li class="navbar-databird-nav-item navbar-databird-drawer-cta">
        <a href="/about/" class="navbar-databird-nav-link navbar-databird-cta {% if page.url == '/about/' %}active{% endif %}" data-i18n="nav.about">
          À propos
          <i class="fas fa-arrow-right" style="font-size: 0.875rem;"></i>
        </a>
      </li>
    </ul>
    </div>

    <!-- Actions -->
    <div class="navbar-databird-actions">
      <!-- Search Button - Premier -->
      <button class="navbar-search-button navbar-databird-search-btn" type="button" aria-label="Rechercher" data-search-trigger data-i18n-aria="nav.search">
        <i class="fas fa-search"></i>
        <span class="search-badge"></span>
      </button>

      <!-- Theme Toggle - Light/Dark -->
      <button class="navbar-theme-toggle" type="button" id="toggle-dark" aria-label="Changer de thème" aria-pressed="false">
        <i class="fas fa-moon theme-toggle-icon"></i>
      </button>

      <!-- Language Switcher -->
      <div class="language-switcher" role="group" aria-label="Language selector">
        <button type="button" data-lang="fr" aria-label="Français" aria-pressed="false">
          <span>FR</span>
        </button>
        <button type="button" data-lang="en" aria-label="English" aria-pressed="false">
          <span>EN</span>
        </button>
      </div>
    </div>

    <!-- Mobile Toggle -->
    <button class="navbar-databird-toggle" id="mobile-menu-toggle" aria-label="Menu mobile" aria-expanded="false" data-i18n-aria="nav.menu">
      <span></span>
      <span></span>
      <span></span>
    </button>
  </div>

</nav>

{% include search.html %}

<script>
// Mobile menu toggle + reset état au chargement (nav et hero cohérents après clic sur le bandeau)
document.addEventListener('DOMContentLoaded', function() {
  var mobileMenu = document.getElementById('mobile-menu');
  var mobileToggle = document.getElementById('mobile-menu-toggle');

  // Réinitialiser menus au chargement (évite dropdown/mobile ouvert après navigation)
  if (mobileMenu) mobileMenu.classList.remove('active');
  if (mobileToggle) {
    mobileToggle.classList.remove('active');
    mobileToggle.setAttribute('aria-expanded', 'false');
  }
  if (mobileMenu) mobileMenu.setAttribute('aria-hidden', 'true');
  document.querySelectorAll('.navbar-databird-dropdown-menu').forEach(function(el) {
    el.classList.remove('show');
  });
  document.querySelectorAll('.navbar-databird-dropdown > .navbar-databird-nav-link').forEach(function(el) {
    el.setAttribute('aria-expanded', 'false');
  });

  // Clic sur le bandeau (logo/titre) : fermer menus avant navigation pour transition propre
  var brand = document.querySelector('.navbar-databird-brand');
  if (brand) {
    brand.addEventListener('click', function() {
      if (mobileMenu) mobileMenu.classList.remove('active');
      if (mobileToggle) mobileToggle.classList.remove('active');
      document.querySelectorAll('.navbar-databird-dropdown-menu').forEach(function(m) { m.classList.remove('show'); });
    });
  }

  const toggle = mobileToggle;
  const menu = mobileMenu;

  if (toggle && menu) {
    toggle.addEventListener('click', function() {
      var isOpen = menu.classList.toggle('active');
      toggle.classList.toggle('active', isOpen);
      toggle.setAttribute('aria-expanded', isOpen);
      menu.setAttribute('aria-hidden', !isOpen);
    });
    window.addEventListener('resize', function() {
      if (window.innerWidth >= 768) {
        menu.classList.remove('active');
        toggle.classList.remove('active');
        toggle.setAttribute('aria-expanded', 'false');
        menu.setAttribute('aria-hidden', 'true');
      }
    });

    // Close drawer when a real link (not dropdown trigger) is clicked
    menu.querySelectorAll('a[href]:not([href="#"])').forEach(link => {
      link.addEventListener('click', () => {
        menu.classList.remove('active');
        toggle.classList.remove('active');
        toggle.setAttribute('aria-expanded', 'false');
        menu.setAttribute('aria-hidden', 'true');
      });
    });
  }

  // Dropdown keyboard navigation
  const dropdownTriggers = document.querySelectorAll('.navbar-databird-dropdown > .navbar-databird-nav-link');
  dropdownTriggers.forEach(trigger => {
    trigger.addEventListener('click', function(e) {
      e.preventDefault();
      const dropdown = this.nextElementSibling;
      const isOpen = dropdown.classList.contains('show');

      // Close all dropdowns
      document.querySelectorAll('.navbar-databird-dropdown-menu').forEach(menu => {
        menu.classList.remove('show');
      });

      // Toggle current dropdown
      if (!isOpen) {
        dropdown.classList.add('show');
        this.setAttribute('aria-expanded', 'true');
      } else {
        this.setAttribute('aria-expanded', 'false');
      }
    });

    // Close on click outside
    document.addEventListener('click', function(e) {
      if (!trigger.contains(e.target) && !trigger.nextElementSibling.contains(e.target)) {
        trigger.nextElementSibling.classList.remove('show');
        trigger.setAttribute('aria-expanded', 'false');
      }
    });
  });

  // Navbar scroll effect
  const navbar = document.querySelector('.navbar-databird');
  if (navbar) {
    window.addEventListener('scroll', function() {
      if (window.scrollY > 50) {
        navbar.classList.add('scrolled');
      } else {
        navbar.classList.remove('scrolled');
      }
    }, { passive: true });
  }
});
</script>
