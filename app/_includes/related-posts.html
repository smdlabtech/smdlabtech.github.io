<!-- Recommandations d'Articles Similaires -->
{% assign maxRelated = 3 %}
{% assign minCommonTags = 1 %}
{% assign maxRelatedCounter = 0 %}

{% for post in site.posts %}
  {% assign sameTagCount = 0 %}
  {% assign commonTags = '' %}

  {% for tag in post.tags %}
    {% if page.tags contains tag %}
      {% assign sameTagCount = sameTagCount | plus: 1 %}
      {% capture tagmarkup %} <span class="badge-modern">{{ tag }}</span> {% endcapture %}
      {% assign commonTags = commonTags | append: tagmarkup %}
    {% endif %}
  {% endfor %}

  {% if sameTagCount >= minCommonTags and post.url != page.url %}
    {% if maxRelatedCounter == 0 %}
<div class="related-posts">
  <h3>Articles Similaires</h3>
  <div class="related-posts-grid">
    {% endif %}
    <div class="related-post-card reveal-on-scroll">
      <h4 class="related-post-title">
        <a href="{{ post.url | relative_url }}">{{ post.title }}</a>
      </h4>
      {% if post.subtitle %}
      <p class="related-post-excerpt">{{ post.subtitle | strip_html | truncatewords: 20 }}</p>
      {% else %}
      <p class="related-post-excerpt">{{ post.excerpt | strip_html | truncatewords: 20 }}</p>
      {% endif %}
      <div class="related-post-meta">
        <i class="far fa-calendar"></i>
        <span>{{ post.date | date: "%d %B %Y" }}</span>
        {% if post.tags.size > 0 %}
        <span>â€¢</span>
        <span>{{ post.tags | first }}</span>
        {% endif %}
      </div>
    </div>
    {% assign maxRelatedCounter = maxRelatedCounter | plus: 1 %}
    {% if maxRelatedCounter >= maxRelated %}
      {% break %}
    {% endif %}
  {% endif %}
{% endfor %}

{% if maxRelatedCounter > 0 %}
  </div>
</div>
{% endif %}
